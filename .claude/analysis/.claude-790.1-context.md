# Context: Validate usage metrics collection

## Request summary
This is a test task to validate that SubagentStart/SubagentStop hooks correctly capture metrics during workflow execution. The actual "work" (a simple greeting utility) already exists - the real purpose is exercising the full workflow to verify metrics collection.

## Current state
The greeting utility has already been implemented:
- `/Users/tomas/.claude/utils/greeting.js` - Function `generateGreeting(name)` that returns "Hello, [name]!" or "Hello, Guest!" if name is null/empty
- `/Users/tomas/.claude/utils/greeting.test.js` - 5 test cases covering normal names, empty string, null, and undefined

All tests pass as of this analysis.

## Metrics infrastructure
The metrics collection system is already in place:
- `/Users/tomas/.claude/.claude/hooks/metrics-start.sh` - Captures stage_start events
- `/Users/tomas/.claude/.claude/hooks/metrics-end.sh` - Captures stage_end events with duration, tokens, cost
- `/Users/tomas/.claude/workflow-metrics.jsonl` - Stores metrics in JSONL format

The hooks fire on SubagentStart/SubagentStop events and capture:
- Session ID, agent ID, stage type
- Task ID from $TASK environment variable
- Duration (calculated from start/end timestamps)
- Token usage (input, output, cache read, cache creation)
- Cost estimation based on model pricing
- Status (completed/blocked)

## Relevant code areas
- `/Users/tomas/.claude/utils/` - Location for utility functions
- `/Users/tomas/.claude/.claude/hooks/` - Hook scripts for metrics collection
- `/Users/tomas/.claude/workflow-metrics.jsonl` - Metrics output file

## Existing patterns to follow
- Simple module.exports pattern for Node.js utilities (see `greeting.js`)
- Console-based test output with pass/fail indicators (see `greeting.test.js`)
- Hook scripts use `set +e` and `|| true` to never break workflow

## Technical constraints
- Metrics collection depends on correct $TASK environment variable being set
- Hook scripts must exit 0 regardless of success/failure
- bd comment posting only works when task ID contains a dot (e.g., .claude-790.1)

## Edge cases to address
Since the greeting utility is already implemented, edge cases are already handled:
- Empty string returns "Hello, Guest!"
- null returns "Hello, Guest!"
- undefined returns "Hello, Guest!"

## Risks
- None for the code itself (already implemented)
- Metrics validation requires completing the full workflow to generate all stage events
